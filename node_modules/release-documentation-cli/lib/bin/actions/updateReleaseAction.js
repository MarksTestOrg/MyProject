'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _inquirer = require('inquirer');

var _gitTags = require('git-tags');

var _gitTags2 = _interopRequireDefault(_gitTags);

var _gitInteractions = require('../github/gitInteractions');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = async (userDetails, repoDetails, version, release) => {
  if (!version) {
    version = await new Promise(resolve => _gitTags2.default.get((err, tags) => resolve(tags[0])));
  }

  await (0, _gitInteractions.taggedRelease)(userDetails, version);
  await (0, _inquirer.prompt)([{
    type: 'confirm',
    name: 'postUpdate',
    message: 'have you completed updating the release notes?'
  }]);

  try {
    const updateReleaseResponse = await (0, _gitInteractions.updateRelease)(userDetails, version, release);

    console.log(`The release notes for ${updateReleaseResponse.name} have been updated! \n` + `You can see the new release notes here: https://github.com/${repoDetails}/releases`);
  } catch (err) {
    console.error('Failed to update the release: ', err);
    process.exitCode = 1;
  }
};