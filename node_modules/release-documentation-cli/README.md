# Release Documentation CLI

## Overview

The Release Documentation CLI tool aims to make Github release documentation easier. It will generate a Github release automatically, containing artifacts and a changelog based on the changes made since the last tagged release.

## Setup

Export the following variables in your shell of choice:

`GIT_USERNAME`
`GIT_ACCESS_TOKEN`

Export the following depending on which CI platform you are using:

`BITRISE_TOKEN`
`JENKINS_TOKEN`
`BUDDYBUILD_TOKEN`
`TEAMCITY_TOKEN`

### Configuration Options

The Release Documentation CLI aims to integrate with a variety of projects.
Depending on the setup of the project additional configuration options may need to be provided.

The configuration file must be placed next to the package.json file within the project structure. `release-documentation-cli.config.json`

The following configuration options are available:

#### gitConfigPath
If your package.json file is not at the root of the project then you will need to specify the following option allowing the release-documentation-cli to read the git configuration of the project:



```
{
  "gitConfigPath": "../.git/config",
}
```

#### testEvidenceJobs

If your release needs to gather test evidence, add the build jobs running the tests to the config file too. This repo currently supports Bitrise, Buddybuild, Jenkins and Teamcity. 

See the example below:

```
{
"testEvidenceJobs":[
        {
            "builds": [
                "ci-tests",
                "more-ci-tests"
            ],
            "ciTool": "bitrise"
        },
        {
            "builds": [
                "even-more-ci-tests"
            ],
            "ciTool": "teamcity"
        }
    ]
}
```

## Run

### Get the Latest Release
command: `release latest`

This command prints the latest release version found on the projects Github releases page.

### Create a New Release
command: `release new`

This command will guide you through creating a new Github release.
Before running this command you will need to tag your latest release using git tags.

Workflow:

```
git tag v1.0.1
git push origin v1.0.1
release new
```

#### Optional Parameters
##### Approved
parameter: ```-a``` ```--approved```

When passing this parameter the release will automatically be marked as approved.

##### Scheduled
parameter: ```-s``` ```--scheduled```

When passing this parameter the release will automatically be scheduled for release using the current date/time.

##### Skip Release Notes
parameter: ```-r``` ```--skipReleaseNotes```

When passing this parameter the additional release notes question will be skipped.

### Update an Existing Release
command: `release update`

This command will update the latest release by default. This will provide you with the ability to modify the ChangeLog and release details using 'vi'.

#### Optional Parameters
##### Version Tag
parameter: ```-v``` ```-versionTag [version]```

When passing this parameter you can specify a different release version to update.

##### Mark Release as Latest
parameter: ```-r``` ```--release [version]```

When this option is provided it will mark the latest release as 'latest', rather than 'prerelease' if the release had not previously been approved by the product owner.

### Bump Version
command: ```release bump-version```

This command will automatically bump the version number up in the package.json file and tag the release based on the committed changes since the last tagged release.

Note: this command will create a commit with the bumped package file. You will also need to ensure that your git workspace is clean before being able to use this command.

### Generate Change Log
command: ```changelog```

Running this command will generate the changelog between the current tag and the last tagged release.

#### Optional Parameters
##### Version Tag Range
parameter: ```-v``` ```--versionTagRange <olderTag>..<newerTag>```

With this option you can generate the changelog between a chosen range.

## Development

`npm install` or `yarn` to get the dependencies

`npm run build` or `yarn build` to build the project (must be done when making changes)

`npm link` to run locally

### Test

`npm run test` or `yarn test` to run the tests with coverage
